
{% extends "base.html" %}
{% block content %}
<h2 class="text-xl font-semibold mb-3">Deliveries</h2>
<form action="/deliveries" method="post" class="grid md:grid-cols-5 gap-2 max-w-5xl">
  <input name="courier" required placeholder="Courier (Shopee/Lazada/J&T...)" class="border rounded px-3 py-2">
  <input name="tracking" required placeholder="Tracking #" class="border rounded px-3 py-2">
  <label class="flex items-center gap-2"><input type="checkbox" name="is_cod" value="true"> COD</label>
  <input name="cod_amount" type="number" step="0.01" placeholder="COD Amount" class="border rounded px-3 py-2">
  <button class="bg-blue-600 text-white rounded px-3 py-2">Log Delivery</button>
  {% if request.query_params.get('receipt') %}
    <a class="text-blue-700 underline" href="/receipt/delivery/{{request.query_params.get('receipt')}}.pdf">Download receipt (PDF)</a>
  {% endif %}
</form>
<table class="w-full text-sm border mt-4">
  <thead class="bg-gray-100">
    <tr>
      <th class="p-2 border">ID</th><th class="p-2 border">Courier</th><th class="p-2 border">Tracking</th>
      <th class="p-2 border">COD?</th><th class="p-2 border">Amount</th><th class="p-2 border">COD Paid</th>
      <th class="p-2 border">Status</th><th class="p-2 border">Action</th>
    </tr>
  </thead>
  <tbody>
  {% for r in rows %}
  <tr>
    <td class="p-2 border">{{r.id}}</td>
    <td class="p-2 border">{{r.courier}}</td>
    <td class="p-2 border">{{r.tracking}}</td>
    <td class="p-2 border">{{ 'Yes' if r.is_cod else 'No' }}</td>
    <td class="p-2 border">{% if r.cod_amount %}â‚±{{"%.2f"|format(r.cod_amount)}}{% else %}-{% endif %}</td>
    <td class="p-2 border">{{ 'Yes' if r.cod_paid else 'No' }}</td>
    <td class="p-2 border">{{r.status}}</td>
    <td class="p-2 border space-x-2">
      {% if r.status != "Received" %}
      <form class="inline" action="/deliveries/{{r.id}}/mark-received" method="post"><button class="bg-green-600 text-white px-2 py-1 rounded">Mark Received</button></form>
      {% endif %}
      {% if r.is_cod and not r.cod_paid %}
      <form class="inline" action="/deliveries/{{r.id}}/mark-cod-paid" method="post"><button class="bg-amber-600 text-white px-2 py-1 rounded">Mark COD Paid</button></form>
      {% endif %}
      <a class="text-blue-700 underline" href="/receipt/delivery/{{r.id}}.pdf">Receipt</a>
    </td>
  </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
